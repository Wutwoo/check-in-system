<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>潤森鑫打卡系統 (v7.0 最终诊断)</title>
<style>body{font-family: Arial, sans-serif;max-width: 800px;margin: 0 auto;padding: 20px;} h1, h2 {text-align: center;}</style>
</head>
<body>
<h1>潤森鑫打卡系統 - 诊断模式</h1>
<div id="clock"></div>
<div id="records"><h2>请按 F12 打开浏览器的 Console，然后将看到的表格截图给我。</h2></div>

<script>
// *** ↓↓↓ 请务必将下面的 URL 替换成您最新部署後的 Web App URL ↓↓↓ ***
const DATABASE_URL = 'https://script.google.com/macros/s/AKfycbzDm81N276SYIzDkEJaFHydg72Kh1OMVShVAjWfLAsh-_Girx625VWNztALr1TDOWiL/exec';

/**
 * *** 核心修改：这是一个诊断函式，它会用表格打印出最原始的数据 ***
 */
function handleData(data) {
  console.log("===================================");
  console.log("终极诊断：从后端接收到的最原始数据");
  console.log("后端传回了一个包含 " + data.length + " 行的阵列。");
  console.log("下面的表格，就是后端在 Google Sheet 中实际读取到的内容：");
  
  // 使用 console.table() 可以用非常清晰的表格格式显示二维阵列
  console.table(data); 
  
  console.log("===================================");

  const recordsDiv = document.getElementById('records');
  if (data && data.length > 1 && data[1][0] !== "") {
      recordsDiv.innerHTML = '<h2>诊断成功！请将 Console 中的表格截图或拍照给我。</h2><p style="color:green; text-align:center;">看起来有读取到数据！</p>';
  } else if (data && data.length > 1 && data[1][0] === "") {
      recordsDiv.innerHTML = '<h2>诊断成功！请将 Console 中的表格截图或拍照给我。</h2><p style="color:red; text-align:center;">警告：后端读取到的单元格是空的！</p>';
  } else {
      recordsDiv.innerHTML = '<h2>诊断完成。</h2><p>后端可能返回了错误或空的工作表。</p>';
  }
}

// 简化版的载入函式
function loadRecords() {
    console.log("开始进行最终诊断...");
    const script = document.createElement('script');
    script.src = DATABASE_URL;
    script.onerror = () => { console.error('诊断脚本载入失败，请检查 URL 或网路连线。'); };
    document.body.appendChild(script);
}

// 简化版的时钟
function updateClock(){ const a=(new Date).toLocaleString("zh-TW",{timeZone:"Asia/Taipei"}); document.getElementById("clock").textContent = `当前时间: ${a}`; }
setInterval(updateClock, 1000);
updateClock();
// 页面载入后立刻执行诊断
loadRecords(); 
</script>
</body>
</html>